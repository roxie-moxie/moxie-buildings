---
milestone: v1.0
audited: 2026-02-21T00:00:00Z
status: tech_debt
scores:
  requirements: 19/20 (Phases 1-4); 6 Phase 5 requirements deferred
  phases: 4/4 (2 passed, 1 gaps_found, 1 human_needed)
  integration: 16/20 wired cleanly; 4 findings
  flows: 3/4 complete; 1 with behavioral gap
gaps:
  requirements:
    - id: "SCRAP-01"
      status: "partial"
      phase: "Phase 2"
      claimed_by_plans: ["02-04-PLAN.md"]
      completed_by_plans: ["02-04-SUMMARY.md (stub only)"]
      verification_status: "partial"
      evidence: "Phase 2 VERIFICATION: _fetch_units() raises NotImplementedError. Tier 1 API scraper is an unreachable stub. However, PLATFORM_SCRAPERS['rentcafe'] now routes to tier2.securecafe (218 buildings working per MEMORY.md). Requirement practically resolved via alternative approach, but formal verification recorded PARTIAL."
  integration:
    - from: "scrapers/base.py save_scrape_result()"
      to: "scheduler/runner.py scrape_one_building()"
      issue: "Two contradictory failure-handling implementations — save_scrape_result retains units on failure (INFRA-03 original contract); runner.py clears units on failure (Phase 3 user decision). CLI tools and batch runner produce different DB states from the same error."
      affected_reqs: ["INFRA-03"]
    - from: "normalizer.py"
      to: "api/routers/units.py"
      issue: "'Available Now' stored as today's date by normalizer, but API filter checks for literal string 'Available Now'. Units scraped as available now may be excluded from date-filtered searches."
      affected_reqs: ["AGENT-01"]
  flows:
    - flow: "Scraper failure handling"
      issue: "Batch pipeline clears units on failure; CLI spot-checks retain units. Path-dependent behavior for INFRA-03."
tech_debt:
  - phase: 02-scrapers
    items:
      - "RentCafe tier1 stub (rentcafe.py) is orphaned — replaced by SecureCafe but file still exists with tests"
      - "Post-scrape bed type audit (SC5) never run — non_canonical flag exists but no audit script executed"
      - "CSS selectors unverified for Funnel/AppFolio/Bozzuto/RealPage — documented as heuristic"
      - "Pre-existing test failures: test_scraper_appfolio.py (stale import _parse_html), test_scraper_llm.py (FakeResult missing .success)"
      - "sightmap absent from KNOWN_PLATFORMS in platform_detect.py (auto-detection impossible for SightMap, sheet column is only path)"
  - phase: 03-scheduler
    items:
      - "Overnight 2 AM cron not confirmed — code verified correct, wall-clock run pending"
      - "Pre-existing Phase 2 test failures carried forward with --ignore flags"
  - phase: 04-api-layer
    items:
      - "Default secret_key 'change-me-in-production' (23 bytes, PyJWT warns)"
      - "create-admin CLI not registered as .exe entry point (uv sync blocked by running process)"
  - phase: roadmap
    items:
      - "ROADMAP.md plan checkboxes stale: 02-06, 02-09, 03-02, 04-01, 04-02, 04-03 show [ ] despite completion"
      - "Phase 5 listed in ROADMAP but no phase directory exists — 6 v1 requirements (AGENT-02 through AGENT-07) assigned to it"
---

# Milestone v1.0 Audit Report

**Milestone:** v1.0 — Moxie Building Aggregator (Phases 1-4)
**Audited:** 2026-02-21
**Status:** TECH DEBT (no critical blockers; accumulated deferred items)

---

## Executive Summary

All 4 implemented phases have been verified. 19 of 20 requirements mapped to Phases 1-4 are satisfied. SCRAP-01 (RentCafe/Yardi) is formally PARTIAL per Phase 2 verification but practically resolved via SecureCafe (218 buildings working). No critical blockers prevent the system from functioning.

6 additional v1 requirements (AGENT-02 through AGENT-07) are assigned to Phase 5 (Frontend), which has no phase directory yet. These are deferred, not failed.

Key tech debt: dual failure-handling implementations, orphaned RentCafe Tier 1 stub, pre-existing test failures, "Available Now" normalizer/API filter mismatch, stale ROADMAP checkboxes.

---

## Phase Verification Summary

| Phase | Status | Score | Key Finding |
|-------|--------|-------|-------------|
| 01 Foundation | PASSED | 5/5 | Clean. All artifacts verified. |
| 02 Scrapers | GAPS_FOUND | 3/5 | RentCafe stub (replaced by SecureCafe post-verification), no bed-type audit run |
| 03 Scheduler | HUMAN_NEEDED | 9/10 | All code verified; overnight 2 AM cron requires wall-clock confirmation |
| 04 API Layer | PASSED | 30/30 | Clean. 42 tests pass. |

---

## Requirements Coverage (3-Source Cross-Reference)

### Phases 1-4: 20 Requirements

| REQ-ID | Description | VERIFICATION | REQUIREMENTS.md | Final Status |
|--------|-------------|-------------|-----------------|--------------|
| INFRA-01 | Sheets sync to DB | SATISFIED | [x] Complete | **satisfied** |
| INFRA-02 | Daily scheduled scrapes | SATISFIED | [x] Complete | **satisfied** |
| INFRA-03 | Retain data on failure, mark stale | SATISFIED | [x] Complete | **satisfied*** |
| DATA-01 | Required unit fields | SATISFIED | [x] Complete | **satisfied** |
| DATA-02 | Optional unit fields | SATISFIED | [x] Complete | **satisfied** |
| DATA-03 | Normalized data before storage | SATISFIED | [x] Complete | **satisfied** |
| SCRAP-01 | Yardi/RentCafe scraped | PARTIAL | [x] Complete | **partial** |
| SCRAP-02 | Entrata scraped | SATISFIED | [x] Complete | **satisfied** |
| SCRAP-03 | PPM scraped | SATISFIED | [x] Complete | **satisfied** |
| SCRAP-04 | Funnel/Nestio scraped | SATISFIED | [x] Complete | **satisfied** |
| SCRAP-05 | RealPage/G5 scraped | SATISFIED | [x] Complete | **satisfied** |
| SCRAP-06 | Bozzuto scraped | SATISFIED | [x] Complete | **satisfied** |
| SCRAP-07 | Groupfox scraped | SATISFIED | [x] Complete | **satisfied** |
| SCRAP-08 | AppFolio scraped | SATISFIED | [x] Complete | **satisfied** |
| SCRAP-09 | LLM fallback scraped | SATISFIED | [x] Complete | **satisfied** |
| AGENT-01 | Agent login + search | SATISFIED | [x] Complete | **satisfied** |
| ADMIN-01 | Create agent accounts | SATISFIED | [x] Complete | **satisfied** |
| ADMIN-02 | Deactivate agents | SATISFIED | [x] Complete | **satisfied** |
| ADMIN-03 | View building list | SATISFIED | [x] Complete | **satisfied** |
| ADMIN-04 | Trigger re-scrape | SATISFIED | [x] Complete | **satisfied** |

*INFRA-03: Two contradictory implementations exist (see Integration Finding 1). Batch runner clears on failure; CLI tools retain. Both are documented decisions.

**SCRAP-01 context:** The Phase 2 verification (2026-02-18) found the Tier 1 API stub. Post-verification, SecureCafe was implemented as an alternative that covers all 218 RentCafe buildings via HTML scraping (no API credentials needed). The registry routes `rentcafe → tier2.securecafe`. The requirement is practically met; the PARTIAL status reflects the formal verification record.

**Note:** SUMMARY.md frontmatter `requirements-completed` field was absent from all 17 plan summaries. The 3-source cross-reference proceeded with 2 sources (VERIFICATION + traceability table).

### Phase 5: 6 Requirements (No Phase Directory)

| REQ-ID | Description | Status |
|--------|-------------|--------|
| AGENT-02 | Filter by bed type | Pending (Phase 5 not started) |
| AGENT-03 | Filter by rent range | Pending (Phase 5 not started) |
| AGENT-04 | Filter by availability date | Pending (Phase 5 not started) |
| AGENT-05 | Filter by neighborhood | Pending (Phase 5 not started) |
| AGENT-06 | Sort results by column | Pending (Phase 5 not started) |
| AGENT-07 | Data freshness indicator | Pending (Phase 5 not started) |

These are v1 requirements mapped to Phase 5 in the ROADMAP and traceability table. Phase 5 has no directory — it appears to be deferred work rather than a milestone failure.

---

## Integration Check Results

### E2E Flow Status

| Flow | Status | Detail |
|------|--------|--------|
| Sheets sync → scrapers → DB → API | **Complete** (1 gap) | "Available Now" units may be excluded from date-filtered API searches |
| Admin → agent creation → login → search | **Complete** | All links wired end-to-end |
| Admin re-scrape → runner → DB → API | **Complete** | Job state in-memory (accepted limitation) |
| Scraper failure → status → admin visibility | **Divergent** | Batch: clears units. CLI: retains units. Both documented. |

### Integration Findings

**1. Dual Failure-Handling (INFRA-03)**
`save_scrape_result()` retains units on failure; `runner.py` clears units on failure. CLI spot-checks (`uv run scrape`, `uv run validate-building`) use the former; batch runner uses the latter. Same building failure produces different DB states depending on entry point. Phase 3 CONTEXT.md documents the clear-on-failure decision as intentional.

**2. "Available Now" Filter Mismatch (AGENT-01)**
`normalizer.py` converts "Available Now" → today's date as YYYY-MM-DD. `api/routers/units.py` checks `Unit.availability_date == "Available Now"` as a special case in the filter. These are misaligned — the normalizer stores a date string, but the API expects the literal text.

**3. SightMap Not in KNOWN_PLATFORMS**
`platform_detect.py` has no SightMap detection pattern (auto-detection impossible since building URLs aren't on sightmap.com). SightMap works correctly via manual sheet classification. Adding `"sightmap"` to `KNOWN_PLATFORMS` would improve validation completeness.

**4. Pre-Existing Test Failures (Deferred)**
`test_scraper_appfolio.py` — stale import (`_parse_html` vs `_parse_listings_html`)
`test_scraper_llm.py` — `FakeResult` mock missing `.success` attribute
Deferred since Phase 2. Running `pytest tests/` without `--ignore` fails.

---

## Tech Debt Summary

**13 items across 4 phases + ROADMAP:**

| Category | Count | Severity |
|----------|-------|----------|
| Orphaned code | 1 | Low (tier1/rentcafe.py, has tests but unreachable) |
| Contradictory behavior | 1 | Medium (failure handling divergence) |
| Missing verification steps | 2 | Low (bed-type audit, overnight cron) |
| Stale tests | 2 | Medium (import errors on full pytest run) |
| Filter bug | 1 | Medium ("Available Now" mismatch) |
| Missing platform validation | 1 | Low (sightmap in KNOWN_PLATFORMS) |
| Stale documentation | 2 | Low (ROADMAP checkboxes, Phase 5 scope) |
| Dev convenience | 2 | Low (secret key, create-admin .exe) |
| Deferred scope | 1 | Info (Phase 5 not started) |

---

## Orphan Detection

**Orphaned requirements:** None within Phases 1-4. All 20 requirements assigned to Phases 1-4 appear in at least one VERIFICATION.md.

**Phase 5 requirements (AGENT-02 through AGENT-07):** Present in REQUIREMENTS.md traceability table, mapped to Phase 5, but Phase 5 has no directory. These are deferred, not orphaned — the phase simply hasn't been created yet.

---

## Recommendation

The milestone is functionally complete for Phases 1-4. The system can:
- Sync buildings from Google Sheets
- Scrape 306/407 buildings across PPM, SightMap, SecureCafe, Groupfox, and LLM platforms
- Run the full batch automatically at 2 AM daily
- Serve authenticated API endpoints for unit search and admin operations

**Suggested before completing the milestone:**
1. Fix the "Available Now" normalizer/API filter mismatch (medium impact, small fix)
2. Fix the 2 broken test files (restores full `pytest` without `--ignore`)
3. Decide: update `save_scrape_result()` to clear-on-failure, or document the divergence explicitly

**Acceptable to defer:**
- Phase 5 (Frontend) — clearly future work
- RentCafe tier1 stub cleanup
- ROADMAP checkbox updates
- Overnight cron confirmation (can be done post-milestone)
